-- 上海景点间路径数据
-- 注意：这些路径是双向的，所以需要插入两条记录

-- 插入景点间路径数据（构建图的边）
INSERT INTO attraction_paths (from_attraction_id, to_attraction_id, distance_km, transport_type_id, travel_time_minutes, cost, description) VALUES

-- 黄浦区核心景点间的路径
-- 外滩(1) <-> 南京路步行街(2)
(1, 2, 0.8, 1, 12, 0, '沿中山东一路步行'),
(2, 1, 0.8, 1, 12, 0, '沿中山东一路步行'),
(1, 2, 0.8, 2, 5, 3, '地铁2号线南京东路站'),
(2, 1, 0.8, 2, 5, 3, '地铁2号线南京东路站'),

-- 外滩(1) <-> 豫园(3)
(1, 3, 1.2, 1, 15, 0, '经河南中路步行'),
(3, 1, 1.2, 1, 15, 0, '经河南中路步行'),
(1, 3, 1.5, 4, 8, 12, '出租车经河南中路'),
(3, 1, 1.5, 4, 8, 12, '出租车经河南中路'),

-- 外滩(1) <-> 城隍庙(4)
(1, 4, 1.0, 1, 12, 0, '经豫园路步行'),
(4, 1, 1.0, 1, 12, 0, '经豫园路步行'),
(1, 4, 1.2, 4, 6, 10, '出租车直达'),
(4, 1, 1.2, 4, 6, 10, '出租车直达'),

-- 外滩(1) <-> 上海博物馆(5)
(1, 5, 1.5, 1, 18, 0, '经南京东路步行'),
(5, 1, 1.5, 1, 18, 0, '经南京东路步行'),
(1, 5, 1.8, 2, 8, 4, '地铁2号线转1号线'),
(5, 1, 1.8, 2, 8, 4, '地铁1号线转2号线'),

-- 外滩(1) <-> 人民广场(6)
(1, 6, 1.3, 1, 16, 0, '经南京东路步行'),
(6, 1, 1.3, 1, 16, 0, '经南京东路步行'),
(1, 6, 1.5, 2, 6, 3, '地铁2号线直达'),
(6, 1, 1.5, 2, 6, 3, '地铁2号线直达'),

-- 南京路步行街(2) <-> 豫园(3)
(2, 3, 0.8, 1, 10, 0, '经河南中路步行'),
(3, 2, 0.8, 1, 10, 0, '经河南中路步行'),
(2, 3, 1.0, 4, 6, 8, '出租车直达'),
(3, 2, 1.0, 4, 6, 8, '出租车直达'),

-- 豫园(3) <-> 城隍庙(4)
(3, 4, 0.2, 1, 3, 0, '步行3分钟即到'),
(4, 3, 0.2, 1, 3, 0, '步行3分钟即到'),

-- 上海博物馆(5) <-> 人民广场(6)
(5, 6, 0.3, 1, 4, 0, '人民广场内步行'),
(6, 5, 0.3, 1, 4, 0, '人民广场内步行'),

-- 黄浦区 <-> 浦东新区的跨江路径
-- 外滩(1) <-> 东方明珠(7)
(1, 7, 1.5, 1, 20, 0, '经外白渡桥步行'),
(7, 1, 1.5, 1, 20, 0, '经外白渡桥步行'),
(1, 7, 2.0, 2, 12, 4, '地铁2号线陆家嘴站'),
(7, 1, 2.0, 2, 12, 4, '地铁2号线陆家嘴站'),
(1, 7, 1.8, 4, 10, 15, '出租车过隧道'),
(7, 1, 1.8, 4, 10, 15, '出租车过隧道'),

-- 外滩(1) <-> 上海中心大厦(8)
(1, 8, 2.2, 2, 15, 4, '地铁2号线陆家嘴站'),
(8, 1, 2.2, 2, 15, 4, '地铁2号线陆家嘴站'),
(1, 8, 2.0, 4, 12, 18, '出租车经延安东路隧道'),
(8, 1, 2.0, 4, 12, 18, '出租车经延安东路隧道'),

-- 外滩(1) <-> 金茂大厦(9)
(1, 9, 2.0, 2, 14, 4, '地铁2号线陆家嘴站'),
(9, 1, 2.0, 2, 14, 4, '地铁2号线陆家嘴站'),
(1, 9, 1.9, 4, 11, 16, '出租车过隧道'),
(9, 1, 1.9, 4, 11, 16, '出租车过隧道'),

-- 浦东新区内部景点连接
-- 东方明珠(7) <-> 上海中心大厦(8)
(7, 8, 0.8, 1, 10, 0, '陆家嘴内步行'),
(8, 7, 0.8, 1, 10, 0, '陆家嘴内步行'),
(7, 8, 1.0, 4, 5, 8, '出租车直达'),
(8, 7, 1.0, 4, 5, 8, '出租车直达'),

-- 东方明珠(7) <-> 金茂大厦(9)
(7, 9, 0.6, 1, 8, 0, '陆家嘴内步行'),
(9, 7, 0.6, 1, 8, 0, '陆家嘴内步行'),
(7, 9, 0.8, 4, 4, 6, '出租车直达'),
(9, 7, 0.8, 4, 4, 6, '出租车直达'),

-- 上海中心大厦(8) <-> 金茂大厦(9)
(8, 9, 0.3, 1, 4, 0, '步行4分钟'),
(9, 8, 0.3, 1, 4, 0, '步行4分钟'),

-- 陆家嘴 <-> 上海科技馆(10)
(7, 10, 8.5, 2, 25, 5, '地铁2号线科技馆站'),
(10, 7, 8.5, 2, 25, 5, '地铁2号线科技馆站'),
(8, 10, 8.8, 2, 26, 5, '地铁2号线科技馆站'),
(10, 8, 8.8, 2, 26, 5, '地铁2号线科技馆站'),

-- 市区 <-> 上海野生动物园(11)
(6, 11, 35.0, 2, 75, 8, '地铁16号线野生动物园站'),
(11, 6, 35.0, 2, 75, 8, '地铁16号线野生动物园站'),
(10, 11, 25.0, 4, 45, 65, '出租车直达'),
(11, 10, 25.0, 4, 45, 65, '出租车直达'),

-- 市区 <-> 上海迪士尼乐园(12)
(6, 12, 38.0, 2, 80, 8, '地铁11号线迪士尼站'),
(12, 6, 38.0, 2, 80, 8, '地铁11号线迪士尼站'),
(11, 12, 15.0, 4, 25, 40, '出租车连接'),
(12, 11, 15.0, 4, 25, 40, '出租车连接'),

-- 静安区景点连接
-- 人民广场(6) <-> 静安寺(13)
(6, 13, 3.5, 2, 10, 3, '地铁2号线静安寺站'),
(13, 6, 3.5, 2, 10, 3, '地铁2号线静安寺站'),
(6, 13, 3.0, 4, 12, 25, '出租车经南京西路'),
(13, 6, 3.0, 4, 12, 25, '出租车经南京西路'),

-- 南京路(2) <-> 静安寺(13)
(2, 13, 2.8, 1, 30, 0, '南京西路步行'),
(13, 2, 2.8, 1, 30, 0, '南京西路步行'),
(2, 13, 3.0, 2, 8, 3, '地铁2号线'),
(13, 2, 3.0, 2, 8, 3, '地铁2号线'),

-- 静安寺(13) <-> 静安雕塑公园(14)
(13, 14, 0.5, 1, 6, 0, '步行6分钟'),
(14, 13, 0.5, 1, 6, 0, '步行6分钟'),

-- 徐汇区景点连接
-- 人民广场(6) <-> 徐家汇天主教堂(15)
(6, 15, 8.0, 2, 20, 4, '地铁1号线徐家汇站'),
(15, 6, 8.0, 2, 20, 4, '地铁1号线徐家汇站'),
(6, 15, 7.5, 4, 18, 60, '出租车经淮海中路'),
(15, 6, 7.5, 4, 18, 60, '出租车经淮海中路'),

-- 徐家汇天主教堂(15) <-> 上海植物园(16)
(15, 16, 6.0, 2, 25, 4, '地铁1号线转3号线'),
(16, 15, 6.0, 2, 25, 4, '地铁3号线转1号线'),
(15, 16, 5.5, 4, 15, 45, '出租车直达'),
(16, 15, 5.5, 4, 15, 45, '出租车直达'),

-- 长宁区景点连接
-- 静安寺(13) <-> 中山公园(17)
(13, 17, 4.5, 2, 12, 3, '地铁2号线中山公园站'),
(17, 13, 4.5, 2, 12, 3, '地铁2号线中山公园站'),
(17, 13, 4.0, 4, 10, 32, '出租车经长宁路'),
(13, 17, 4.0, 4, 10, 32, '出租车经长宁路'),

-- 普陀区景点连接
-- 中山公园(17) <-> 长风公园(18)
(17, 18, 2.8, 2, 8, 3, '地铁2号线娄山关路站'),
(18, 17, 2.8, 2, 8, 3, '地铁2号线娄山关路站'),
(17, 18, 2.5, 4, 8, 20, '出租车直达'),
(18, 17, 2.5, 4, 8, 20, '出租车直达'),

-- 虹口区景点连接
-- 外滩(1) <-> 鲁迅公园(19)
(1, 19, 3.5, 2, 15, 4, '地铁3号线转8号线'),
(19, 1, 3.5, 2, 15, 4, '地铁8号线转3号线'),
(1, 19, 3.2, 4, 12, 25, '出租车经四川北路'),
(19, 1, 3.2, 4, 12, 25, '出租车经四川北路'),

-- 杨浦区景点连接
-- 鲁迅公园(19) <-> 共青森林公园(20)
(19, 20, 8.5, 2, 30, 5, '地铁8号线转地铁12号线'),
(20, 19, 8.5, 2, 30, 5, '地铁12号线转8号线'),
(19, 20, 7.8, 4, 20, 62, '出租车经军工路'),
(20, 19, 7.8, 4, 20, 62, '出租车经军工路'),

-- 闵行区景点连接
-- 人民广场(6) <-> 七宝古镇(21)
(6, 21, 18.0, 2, 45, 6, '地铁9号线七宝站'),
(21, 6, 18.0, 2, 45, 6, '地铁9号线七宝站'),
(6, 21, 16.5, 4, 35, 45, '出租车经沪闵路'),
(21, 6, 16.5, 4, 35, 45, '出租车经沪闵路'),

-- 青浦区景点连接
-- 人民广场(6) <-> 朱家角古镇(22)
(6, 22, 48.0, 3, 90, 15, '公交青浦线路'),
(22, 6, 48.0, 3, 90, 15, '公交青浦线路'),
(6, 22, 45.0, 4, 60, 120, '出租车经G50高速'),
(22, 6, 45.0, 4, 60, 120, '出租车经G50高速'),

-- 嘉定区景点连接
-- 人民广场(6) <-> 汇龙潭公园(23)
(6, 23, 32.0, 2, 65, 7, '地铁11号线嘉定北站'),
(23, 6, 32.0, 2, 65, 7, '地铁11号线嘉定北站'),
(6, 23, 28.0, 4, 50, 75, '出租车经嘉定线'),
(23, 6, 28.0, 4, 50, 75, '出租车经嘉定线'),

-- 松江区景点连接
-- 人民广场(6) <-> 佘山国家森林公园(24)
(6, 24, 35.0, 2, 70, 7, '地铁9号线佘山站'),
(24, 6, 35.0, 2, 70, 7, '地铁9号线佘山站'),
(6, 24, 32.0, 4, 55, 85, '出租车经G60高速'),
(24, 6, 32.0, 4, 55, 85, '出租车经G60高速'),

-- 奉贤区景点连接
-- 人民广场(6) <-> 海湾国家森林公园(25)
(6, 25, 55.0, 3, 120, 18, '公交奉贤线路'),
(25, 6, 55.0, 3, 120, 18, '公交奉贤线路'),
(6, 25, 50.0, 4, 80, 135, '出租车经S4高速'),
(25, 6, 50.0, 4, 80, 135, '出租车经S4高速'),

-- 崇明区景点连接
-- 人民广场(6) <-> 东平国家森林公园(26)
(6, 26, 75.0, 3, 150, 25, '公交崇明线路'),
(26, 6, 75.0, 3, 150, 25, '公交崇明线路'),
(6, 26, 70.0, 4, 100, 185, '出租车经长江隧桥'),
(26, 6, 70.0, 4, 100, 185, '出租车经长江隧桥'),

-- 创意园区连接
-- 豫园(3) <-> 田子坊(27)
(3, 27, 2.5, 1, 25, 0, '经打浦桥步行'),
(27, 3, 2.5, 1, 25, 0, '经打浦桥步行'),
(3, 27, 2.8, 2, 12, 4, '地铁9号线打浦桥站'),
(27, 3, 2.8, 2, 12, 4, '地铁9号线打浦桥站'),

-- 田子坊(27) <-> 新天地(28)
(27, 28, 1.5, 1, 15, 0, '经淮海中路步行'),
(28, 27, 1.5, 1, 15, 0, '经淮海中路步行'),
(27, 28, 1.8, 4, 6, 14, '出租车直达'),
(28, 27, 1.8, 4, 6, 14, '出租车直达'),

-- 新天地(28) <-> 人民广场(6)
(28, 6, 2.0, 1, 20, 0, '经黄陂南路步行'),
(6, 28, 2.0, 1, 20, 0, '经黄陂南路步行'),
(28, 6, 2.2, 2, 8, 3, '地铁1号线黄陂南路站'),
(6, 28, 2.2, 2, 8, 3, '地铁1号线黄陂南路站'),

-- 虹口区 <-> 1933老场坊(29)
(19, 29, 2.0, 1, 20, 0, '四川北路步行'),
(29, 19, 2.0, 1, 20, 0, '四川北路步行'),
(19, 29, 2.5, 4, 8, 18, '出租车直达'),
(29, 19, 2.5, 4, 8, 18, '出租车直达'),

-- 1933老场坊(29) <-> 外滩(1)
(29, 1, 2.8, 1, 28, 0, '经北苏州路步行'),
(1, 29, 2.8, 1, 28, 0, '经北苏州路步行'),
(29, 1, 3.0, 4, 10, 22, '出租车经外白渡桥'),
(1, 29, 3.0, 4, 10, 22, '出租车经外白渡桥'),

-- 普陀区 <-> M50创意园(30)
(18, 30, 1.5, 1, 15, 0, '步行至莫干山路'),
(30, 18, 1.5, 1, 15, 0, '步行至莫干山路'),
(18, 30, 2.0, 4, 6, 16, '出租车直达'),
(30, 18, 2.0, 4, 6, 16, '出租车直达'),

-- M50创意园(30) <-> 静安寺(13)
(30, 13, 3.5, 2, 15, 4, '地铁3号线转2号线'),
(13, 30, 3.5, 2, 15, 4, '地铁2号线转3号线'),
(30, 13, 3.2, 4, 12, 26, '出租车经苏州河'),
(13, 30, 3.2, 4, 12, 26, '出租车经苏州河'),

-- 共享单车连接路径（适合短距离）
-- 外滩周边共享单车路径
(1, 2, 0.8, 6, 18, 2, '共享单车沿中山东一路'),
(2, 1, 0.8, 6, 18, 2, '共享单车沿中山东一路'),
(1, 3, 1.2, 6, 22, 3, '共享单车经河南中路'),
(3, 1, 1.2, 6, 22, 3, '共享单车经河南中路'),

-- 人民广场周边共享单车路径
(5, 6, 0.3, 6, 5, 1, '共享单车人民广场内'),
(6, 5, 0.3, 6, 5, 1, '共享单车人民广场内'),
(6, 13, 3.5, 6, 35, 8, '共享单车经南京西路'),
(13, 6, 3.5, 6, 35, 8, '共享单车经南京西路'),

-- 陆家嘴共享单车路径
(7, 8, 0.8, 6, 12, 2, '共享单车陆家嘴环路'),
(8, 7, 0.8, 6, 12, 2, '共享单车陆家嘴环路'),
(7, 9, 0.6, 6, 10, 2, '共享单车世纪大道'),
(9, 7, 0.6, 6, 10, 2, '共享单车世纪大道'),
(8, 9, 0.3, 6, 6, 1, '共享单车银城中路'),
(9, 8, 0.3, 6, 6, 1, '共享单车银城中路'),

-- 创意园区共享单车路径
(27, 28, 1.5, 6, 18, 3, '共享单车经淮海中路'),
(28, 27, 1.5, 6, 18, 3, '共享单车经淮海中路'),
(28, 6, 2.0, 6, 24, 4, '共享单车经黄陂南路'),
(6, 28, 2.0, 6, 24, 4, '共享单车经黄陂南路');

-- 创建查询视图，便于后续使用
CREATE VIEW attraction_graph AS
SELECT 
    ap.from_attraction_id,
    ap.to_attraction_id,
    ap.distance_km,
    ap.travel_time_minutes,
    ap.cost,
    a1.name AS from_attraction_name,
    a2.name AS to_attraction_name,
    tt.name AS transport_type,
    ap.description
FROM attraction_paths ap
JOIN attractions a1 ON ap.from_attraction_id = a1.id
JOIN attractions a2 ON ap.to_attraction_id = a2.id
JOIN transport_types tt ON ap.transport_type_id = tt.id;

-- 创建查询所有景点信息的视图
CREATE VIEW attraction_details AS
SELECT 
    a.id,
    a.name,
    a.english_name,
    a.description,
    a.price,
    a.opening_hours,
    a.latitude,
    a.longitude,
    a.district,
    a.address,
    a.rating,
    at.type_name AS attraction_type,
    a.recommend_duration
FROM attractions a
LEFT JOIN attraction_types at ON a.type_id = at.id;

-- 创建个性化推荐查询视图
CREATE VIEW personalized_recommendations AS
SELECT 
    a.id AS attraction_id,
    a.name AS attraction_name,
    vt.type_name AS visitor_type,
    ar.recommendation_score,
    ar.reason,
    a.price,
    a.rating,
    a.district
FROM attraction_recommendations ar
JOIN attractions a ON ar.attraction_id = a.id
JOIN visitor_types vt ON ar.visitor_type_id = vt.id
ORDER BY ar.recommendation_score DESC; 